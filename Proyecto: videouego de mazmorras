#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#define YELLOW  "\033[1;33m"
#define RED     "\033[1;31m"
#define BLUE    "\033[1;34m"
#define RESET   "\033[0m"
#define YELLOW  "\033[1;33m"
#define GREEN   "\033[1;32m"
#define MAGENTA "\033[1;35m"
#define CYAN    "\033[1;36m"
void limpiar_consola() {
    printf("\033[H\033[J");
}

void bienvenida(char nombre[20]) {
    while (1) {
        puts("Bienvenido jugador. Ingrese su nombre: ");
        scanf("%s", nombre);
        limpiar_consola();
        break;
    }
}

void rellenarMazmorras(int tamañomazmorra, char dungeon[tamañomazmorra][tamañomazmorra], int dificultad) {
    srand(time(NULL));
    int r;
    char enemigos[2] = {'1', '2'};
    for (int i = 0; i < tamañomazmorra; i++) {
        for (int j = 0; j < tamañomazmorra; j++) {
            r = rand() % 10;
            if (r > dificultad) {
                dungeon[i][j] = '*';
            } else {
                dungeon[i][j] = enemigos[rand() % 2];
            }
        }
    }
}

void imprimirMazmorra(int tamañomazmorra, char dungeon[tamañomazmorra][tamañomazmorra], int fila, int columna) {
    for (int i = fila - 1; i <= fila + 1; i++) {
        for (int j = columna - 1; j <= columna + 1; j++) {
            if (i >= 0 && i < tamañomazmorra && j >= 0 && j < tamañomazmorra) {
                printf("%c ", dungeon[i][j]);
            } else {
                printf("  ");
            }
        }
        printf("\n");
    }
}

void actualizar_mazmorra(int n, char mazmorra[n][n], int fila, int columna, int fila_nueva, int columna_nueva, char *original) {
    mazmorra[fila][columna] = *original; // Restaurar el valor original
    *original = mazmorra[fila_nueva][columna_nueva]; // Guardar el valor de la nueva casilla
    mazmorra[fila_nueva][columna_nueva] = '5'; // Mover al jugador
}

int movimientos(int Nmazmorra, int tamañomazmorra, char mazmorra[tamañomazmorra][tamañomazmorra], char jugador) {
    srand(time(NULL));
    int fila = rand() % Nmazmorra;
    int columna = rand() % Nmazmorra;
    int nuevafila = fila;
    int nuevacolumna = columna;
    char movimiento;
    char original = mazmorra[fila][columna];
    mazmorra[fila][columna] = jugador;
    limpiar_consola();
    imprimirMazmorra(tamañomazmorra, mazmorra, fila, columna);
    while (1) {
        scanf(" %c", &movimiento);
        if (movimiento == 'w') {
            nuevafila = fila - 1;
            nuevacolumna = columna;
        } else if (movimiento == 'a') {
            nuevafila = fila;
            nuevacolumna = columna - 1;
        } else if (movimiento == 's') {
            nuevafila = fila + 1;
            nuevacolumna = columna;
        } else if (movimiento == 'd') {
            nuevafila = fila;
            nuevacolumna = columna + 1;
        } else {
            limpiar_consola();
            imprimirMazmorra(tamañomazmorra, mazmorra, fila, columna);
            puts("Opción inválida");
            continue;
        }
        if (nuevafila < 0 || nuevafila >= Nmazmorra || nuevacolumna < 0 || nuevacolumna >= Nmazmorra) {
            puts("Movimiento fuera de los límites.");
            continue;
        }
        actualizar_mazmorra(tamañomazmorra, mazmorra, fila, columna, nuevafila, nuevacolumna, &original);
        fila = nuevafila;
        columna = nuevacolumna;
        limpiar_consola();
        imprimirMazmorra(tamañomazmorra, mazmorra, fila, columna);
    }
    return 0;
}

void opcion2() {
    limpiar_consola();
    printf(BLUE"┌───────────────────────────────┐\n" RESET);
    printf(BLUE"│    Reglas del juego:           │\n"RESET);
    printf(BLUE"├────────────────────────────────┤\n"RESET);
    printf(BLUE"│- Tienes que llegar hasta       │\n"RESET);
    printf(BLUE"│  la mazmorra 3 y vencer al     │\n"RESET);
    printf(BLUE"│  jefe.                         │\n"RESET);
    printf(BLUE"│                                │\n"RESET);
    printf(BLUE"│- En cada mazmorra              │\n"RESET);
    printf(BLUE"│  habrán enemigos que           │\n"RESET);
    printf(BLUE"│  tratarán de matarte           │\n"RESET);
    printf(BLUE"│                                │\n"RESET);
    printf(BLUE"│- También habrán                │\n"RESET);
    printf(BLUE"│  objetos que mejorarán tus     │\n"RESET);
    printf(BLUE"│  capacidades, como la vida     │\n"RESET);
    printf(BLUE"│  o la fuerza.                  │\n"RESET);
    printf(BLUE"└────────────────────────────────┘\n"RESET);
    printf("Presiona Enter para salir");
    getchar();
    limpiar_consola();
}

void opcion3() {
    limpiar_consola();
    puts("        ┌─────┐               w: moverte hacia arriba");
    puts("        │  w  │");
    puts("        └─────┘               a: moverte hacia la izquierda");
    puts("┌─────┐ ┌─────┐  ┌─────┐");
    puts("│  a  │ │  s  │  │  d  │      s: moverte hacia abajo");
    puts("└─────┘ └─────┘  └─────┘");
    puts("                              d: moverte hacia la derecha");
    puts("Presiona Enter para salir");
    getchar();
    limpiar_consola();
}

void opcion4() {
    limpiar_consola();
    puts("1: Tiene x cantidad de vida. Te quita x cantidad de vida");
    puts("2: Tiene x cantidad de vida. Te quita x cantidad de vida");
    puts("Presiona Enter para salir");
    getchar();
    limpiar_consola();
}

void opcion5() {
    limpiar_consola();
    printf(GREEN"3: te da un aumento de vida de x cantidad\n"RESET);
    printf(GREEN"4: te da un aumento de vida de x cantidad\n"RESET);
    printf("Presiona Enter para salir");
    getchar();
    limpiar_consola();
}

void mostrarMenu() {
    printf(BLUE"┌──────────────┐\n"RESET);
    printf(BLUE"│ Menú:         │\n"RESET);
    printf(BLUE"│ 1. Jugar      │\n"RESET);
    printf(BLUE"│ 2. Reglas     │\n"RESET);
    printf(BLUE"│ 3. Controles  │\n"RESET);
    printf(BLUE"│ 4. Enemigos   │\n"RESET);
    printf(BLUE"│ 5. Items      │\n"RESET);
    printf(BLUE"│ 6. Salir      │\n"RESET);
    printf(BLUE"└──────────────┘\n"RESET);
}

int main(int argc, char *argv[]) {
    char jugador = '5';
    char mazmorra1[15][15];
    int opcion;
    char nombre[20];
    
    printf(YELLOW"┌───────────────────────────────────────┐\n"RESET);
    printf(YELLOW"│           Juego de Mazmorra           │\n"RESET);
    printf(YELLOW"└──────────────────────────────────────┘\n"RESET);
    bienvenida(nombre);
    limpiar_consola();
    mostrarMenu();
    
    while (1) {
        printf("Ingrese una opción: ");
        if (scanf("%d", &opcion) != 1) {
            // Limpiar el buffer de entrada en caso de entrada no válida
            while (getchar() != '\n');
            printf(RED"Opción inválida. Por favor, ingrese una opción válida.\n" RESET);
            continue;
        }
        
        getchar(); // Captura el Enter después de ingresar la opción
        
        switch (opcion) {
            case 1:
                limpiar_consola();
                rellenarMazmorras(15, mazmorra1, 4);
                movimientos(15, 15, mazmorra1, jugador);
                limpiar_consola();
                mostrarMenu();
                break;
            case 2:
                opcion2();
                limpiar_consola();
                mostrarMenu();
                break;
            case 3:
                opcion3();
                limpiar_consola();
                mostrarMenu();
                break;
            case 4:
                opcion4();
                limpiar_consola();
                mostrarMenu();
                break;
            case 5:
                opcion5();
                limpiar_consola();
                mostrarMenu();
                break;
            case 6:
                limpiar_consola();
                puts("Saliendo...");
                return 0;
            default:
                puts("Opción inválida. Por favor, ingrese una opción válida.");
                break;
        }
    }
    
    return 0;
}
